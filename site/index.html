<!doctype html>
<html lang="en">
  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-171578300-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-171578300-1');
    </script>
    <meta charset="UTF-8">
    <title>Touge.Pro</title>
    <link rel="stylesheet" href="/static/leaflet.css"></link>
    <link rel="stylesheet" href="/static/mapbox-gl.css"></link>
    <script type="text/javascript" src="/static/mapbox-gl.js"></script>
    <script type="text/javascript" src="/static/leaflet.js"></script>
    <script type="text/javascript" src="/static/esri-leaflet.js"></script>
    <script type="text/javascript" src="/static/esri-leaflet-vector.js"></script>
    <script type="text/javascript" src="/static/L.KML.js"></script>
    <style>
      #map {
        height: 100%;
        width: 100%;
        position: absolute;
        margin: 0;
        padding: 0;
        top:0;
        left:0;
        right:0;
        bottom:0;
      }
    </style>


    <script>
      var basePos = [38.7810426,-9.4188726];
      var baseZoom = 11;
      var tileServer = "";

      function init() {
        var map = L.map('map')
        map.setView(basePos, baseZoom)
        // L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        //   maxZoom: 19,
        //   attribution: '&copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap contributors</a>'
        // }).addTo(map);

        var layer = L.esri.Vector.basemap('StreetsNight').addTo(map);

        // Load kml file
        fetch('map.xml')
          .then(res => res.text())
          .then(kmltext => {
            // Create new kml overlay
            const parser = new DOMParser();
            const kml = parser.parseFromString(kmltext, 'text/xml');
            const track = new L.KML(kml);
            map.addLayer(track);

            // Adjust map to show the kml
            //const bounds = track.getBounds();
            //map.fitBounds(bounds);
          });

      }

    </script>
  </head>
  <body onload="init();">
    <div id="map"></div>
  </body>
</html>